# Atlantis Environment Configuration

#================================================================================================
# CORE CONFIGURATION
#================================================================================================
# Environment
TZ=Asia/Jakarta
PYTHONPATH=/usr/local/lib/python3.12/site-packages

#================================================================================================
# VOLUME CONFIGURATION
#================================================================================================
# Volume Driver
VOLUMES_DRIVER=local

# Base Data Paths
DATA_PATH=/opt/data/docker

# Data directories
DATA_ATLANTIS=/opt/data/docker/atlantis
DATA_ATLANTIS_AWS=/opt/data/docker/atlantis/aws
DATA_ATLANTIS_SRC=/opt/data/docker/atlantis/src

# Using container binding volume path
DATA_ATLANTIS_CONFIG=/opt/data/docker/atlantis/config
DATA_POSTGRESQL=/opt/data/docker/postgresql/data

#================================================================================================
# CONTAINER CONFIGURATION
#================================================================================================
# Portainer Container
CONTAINER_PORTAINER=bgsi_portainer
CONTAINER_IP_PORTAINER=172.150.150.5
PORT_PORTAINER=5212

# Atlantis Container
CONTAINER_ATLANTIS=bgsi_atlantis
CONTAINER_IP_ATLANTIS=172.150.150.6
CONTAINER_IP_ATLANTIS_DB=172.150.150.4
PORT_ATLANTIS=4141

# Nginx Container
CONTAINER_NGINX=bgsi_nginx
DATA_NGINX=/opt/data/docker/nginx
CONTAINER_IP_NGINX=172.150.150.7

# PostgreSQL Container
CONTAINER_POSTGRESQL=bgsi_postgresql
CONTAINER_IP_POSTGRESQL=172.150.150.8
# PostgreSQL Settings
POSTGRES_USER=sonar
POSTGRES_PASSWORD=sonar
POSTGRES_DB=sonar

#================================================================================================
# IMAGE CONFIGURATION
#================================================================================================
# Atlantis
ATLANTIS_VERSION=latest
# ATLANTIS_IMAGE=463470956521.dkr.ecr.ap-southeast-3.amazonaws.com/bgsi/atlantis-bgsi
ATLANTIS_IMAGE=devopsxti/atlantis-bgsi:latest

# Version tags
PORTAINER_VERSION=2.30.1-alpine
PORTAINER_TEMPLATE=generic
POSTGRES_VERSION=15.4-alpine
SONARQUBE_VERSION=10.3-community
NGINX_VERSION=1.25.3-alpine


#================================================================================================
# GITHUB CONFIGURATION
#================================================================================================
ATLANTIS_GH_HOSTNAME=github.com
ATLANTIS_GH_USER=bgsi-gh-user
ATLANTIS_GH_EMAIL=devops@example.com
ATLANTIS_WEB_HOSTNAME=atlantis.example.com
ATLANTIS_WEB_BASIC_AUTH=true
ATLANTIS_REPO_ALLOWLIST=github.com/bgsi-id/*
ATLANTIS_REPO_CONFIG=/atlantis/repo.yaml
ATLANTIS_CONFIG_PATH=/atlantis/config
ATLANTIS_CHECKOUT_STRATEGY=merge
ATLANTIS_CHECKOUT_DEPTH=10  # Number of commit hash
GIT_USER_NAME="BGSI DevOps"

ATLANTIS_HIDE_PREV_PLAN_COMMENTS=true
ATLANTIS_TEST_TIMEOUT=600
ATLANTIS_LOG_LEVEL=warn
ENABLE_SECURITY_AUDIT=true
LOG_LEVEL=INFO

# Security Secrets (DO NOT COMMIT - Set these in .env local)
# ATLANTIS_GH_TOKEN=your-github-token
# ATLANTIS_GH_WEBHOOK_SECRET=your-webhook-secret

#================================================================================================
# AWS CONFIGURATION
#================================================================================================
# Region
AWS_REGION=ap-southeast-3

# Account Structure (replace with your account IDs)
BGSI_MANAGEMENT_ACCOUNT=
BGSI_SECURITY_ACCOUNT=
BGSI_LOGS_ACCOUNT=
BGSI_BILLING_ACCOUNT=

# Production Accounts
BGSI_RSCM_ACCOUNT=442799077487
BGSI_RSPON_ACCOUNT=829990487185
BGSI_SARDJITO_ACCOUNT=938674806253
BGSI_RSNGOERAH_ACCOUNT=136839993415
BGSI_RSJPD_ACCOUNT=602006056899
### BGSI-Central using AWS RSCM-UAT (temporary) ###
BGSI_CENTRAL_ACCOUNT=695094375681

# UAT Accounts
BGSI_RSCM_UAT_ACCOUNT=695094375681
BGSI_RSPON_UAT_ACCOUNT=741464515101
BGSI_SARDJITO_UAT_ACCOUNT=819520291687
BGSI_RSNGOERAH_UAT_ACCOUNT=899630542732
BGSI_RSJPD_UAT_ACCOUNT=148450585096

#================================================================================================
# SECURITY CONFIGURATION
#================================================================================================
# Basic Auth
NGINX_BASIC_AUTH_USER=bgsi-admin
NGINX_BASIC_AUTH_PASS=B4s1c-4uth

#================================================================================================
# TOOL VERSIONS
#================================================================================================
CONFTEST_VERSION=0.56.0
PYTHON_VERSION=3.12
NODE_VERSION=20

#================================================================================================
# RESOURCE LIMITS
#================================================================================================
# Atlantis Resources
ATLANTIS_CPU_LIMIT=2048m
ATLANTIS_MEMORY_LIMIT=8Gi
ATLANTIS_CPU_REQUEST=300m
ATLANTIS_MEMORY_REQUEST=256Mi

# Nginx Resources
NGINX_CPU_LIMIT=300m
NGINX_MEMORY_LIMIT=512Mi
NGINX_CPU_REQUEST=100m
NGINX_MEMORY_REQUEST=128Mi

#================================================================================================
# HEALTH CHECK CONFIGURATION
#================================================================================================
HEALTH_CHECK_INTERVAL=60s
HEALTH_CHECK_TIMEOUT=5s
HEALTH_CHECK_RETRIES=5

#================================================================================================
# WORKFLOW CONFIGURATION
#================================================================================================
# Atlantis Settings
ATLANTIS_AUTOMERGE=true
ATLANTIS_PARALLEL_PLAN=true
ATLANTIS_PARALLEL_APPLY=true
ATLANTIS_ALLOW_COMMANDS=version,plan,apply,unlock,approve_policies

#================================================================================================
# ATLANTIS DATABASE CONFIGURATION
#================================================================================================
ATLANTIS_DB_TYPE=postgres
ATLANTIS_DB_HOST=172.150.150.4
ATLANTIS_DB_PORT=5432
ATLANTIS_DB_NAME=bgsi_atlantis_db
ATLANTIS_DB_USER=postgres
ATLANTIS_DB_PASSWORD=
ATLANTIS_DB_SSL_MODE=disable

#================================================================================================
# BACKUP CONFIGURATION
#================================================================================================
BACKUP_RETENTION_DAYS=30
BACKUP_PATH=/backup/atlantis

#================================================================================================
# SONARQUBE CONFIGURATION
#================================================================================================
# Main Controls
ENABLE_SONARQUBE=true                          # true/false - Master toggle
SONARQUBE_REQUIRED=false                       # true/false - Fail pipeline if SonarQube fails
SONARQUBE_QUALITY_GATE_REQUIRED=false          # true/false - Fail on quality gate failure

# SonarQube Server
SONAR_HOST_URL=http://sonarqube_web:9000
SONAR_TOKEN=__sonarqube_token__

# Production Environment Tokens
SONAR_TOKEN_RSCM=__sonarqube_token__
SONAR_TOKEN_RSPON=__sonarqube_token__
SONAR_TOKEN_SARDJITO=__sonarqube_token__
SONAR_TOKEN_RSNGOERAH=__sonarqube_token__
SONAR_TOKEN_RSJPD=__sonarqube_token__
SONAR_TOKEN_CENTRAL=__sonarqube_token__

# UAT Environment Tokens
SONAR_TOKEN_RSCM_UAT=__sonarqube_token__
SONAR_TOKEN_RSPON_UAT=__sonarqube_token__
SONAR_TOKEN_SARDJITO_UAT=__sonarqube_token__
SONAR_TOKEN_RSNGOERAH_UAT=__sonarqube_token__
SONAR_TOKEN_RSJPD_UAT=__sonarqube_token__

# Production Environment Project Keys
SONAR_PROJECT_KEY=bgsi-cicd-gaspi
SONAR_PROJECT_KEY_RSCM=bgsi-cicd-gaspi-rscm
SONAR_PROJECT_KEY_RSPON=bgsi-cicd-gaspi-rspon
SONAR_PROJECT_KEY_SARDJITO=bgsi-cicd-gaspi-sardjito
SONAR_PROJECT_KEY_RSNGOERAH=bgsi-cicd-gaspi-rsngoerah
SONAR_PROJECT_KEY_RSJPD=bgsi-cicd-gaspi-rsjpd
SONAR_PROJECT_KEY_CENTRAL=bgsi-cicd-gaspi-central

# UAT Environment Project Keys
SONAR_PROJECT_KEY_RSCM_UAT=bgsi-cicd-gaspi-rscm-uat
SONAR_PROJECT_KEY_RSPON_UAT=bgsi-cicd-gaspi-rspon-uat
SONAR_PROJECT_KEY_SARDJITO_UAT=bgsi-cicd-gaspi-sardjito-uat
SONAR_PROJECT_KEY_RSNGOERAH_UAT=bgsi-cicd-gaspi-rsngoerah-uat
SONAR_PROJECT_KEY_RSJPD_UAT=bgsi-cicd-gaspi-rsjpd-uat

# Scanner Configuration
SONAR_SCANNER_IMAGE=sonarsource/sonar-scanner-cli:latest
SONAR_ANALYSIS_TIMEOUT=3600
SONAR_SCANNER_OPTS=-Xmx2048m

# Container Configuration
CONTAINER_SONAR_SCAN=bgsi_sonar_scanner
CONTAINER_SONARQUBE=bgsi_sonarqube_local
CONTAINER_IP_SONAR_SCAN=172.150.150.8
CONTAINER_IP_SONARQUBE=172.150.150.9

# Data Directories
DATA_SONAR=/opt/data/docker/sonarqube
DATA_SONAR_REPORTS=/opt/data/docker/sonarqube/reports

# Optional: Local SonarQube Server
PORT_SONARQUBE=9000
SONAR_DB_USER=postgres
SONAR_DB_PASSWORD=
SONAR_WEB_JAVAOPTS=-Xmx2048m -Xms1024m
SONAR_CE_JAVAOPTS=-Xmx2048m -Xms1024m

#================================================================================================
# SCRIPT CONTROLS
#================================================================================================
# Test and Code Quality
SCRIPT_RUN_TEST=true                           # Run application tests
SCRIPT_RUN_SONAR=true                          # Run SonarQube scans
SONAR_FAIL_ON_ERROR=false                      # Fail deployment if SonarQube fails
