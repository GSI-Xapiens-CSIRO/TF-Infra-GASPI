# Atlantis Environment Configuration

#================================================================================================
# CORE CONFIGURATION
#================================================================================================
# Environment
TZ=Asia/Jakarta
PYTHONPATH=/usr/local/lib/python3.12/site-packages

#================================================================================================
# VOLUME CONFIGURATION
#================================================================================================
# Volume Driver
VOLUMES_DRIVER=local

# Base Data Paths
DATA_PATH=/opt/data/docker

# Data directories
DATA_ATLANTIS=/opt/data/docker/atlantis
DATA_ATLANTIS_AWS=/opt/data/docker/atlantis/aws
DATA_ATLANTIS_SRC=/opt/data/docker/atlantis/src

# Using container binding volume path
DATA_ATLANTIS_CONFIG=/opt/data/docker/atlantis/config
DATA_POSTGRESQL=/opt/data/docker/postgresql/data

#================================================================================================
# CONTAINER CONFIGURATION
#================================================================================================
# Portainer Container
CONTAINER_PORTAINER=gxc_portainer
CONTAINER_IP_PORTAINER=172.149.149.5
PORT_PORTAINER=5212

# Atlantis Container
CONTAINER_ATLANTIS=gxc_atlantis
CONTAINER_IP_ATLANTIS=172.149.149.6
CONTAINER_IP_ATLANTIS_DB=172.149.149.4
PORT_ATLANTIS=4141

# Nginx Container
CONTAINER_NGINX=gxc_nginx
DATA_NGINX=/opt/data/docker/nginx
CONTAINER_IP_NGINX=172.149.149.7

# PostgreSQL Container
CONTAINER_POSTGRESQL=gxc_postgresql
CONTAINER_IP_POSTGRESQL=172.149.149.8
# PostgreSQL Settings
POSTGRES_USER=sonar
POSTGRES_PASSWORD=sonar
POSTGRES_DB=sonar

#================================================================================================
# IMAGE CONFIGURATION
#================================================================================================
# Atlantis
ATLANTIS_VERSION=latest
# ATLANTIS_IMAGE=463470956521.dkr.ecr.ap-southeast-3.amazonaws.com/gxc/atlantis-gxc
ATLANTIS_IMAGE=devopsxti/atlantis-gxc:latest

# Version tags
PORTAINER_VERSION=2.30.1-alpine
PORTAINER_TEMPLATE=generic
POSTGRES_VERSION=15.4-alpine
SONARQUBE_VERSION=10.3-community
NGINX_VERSION=1.25.3-alpine


#================================================================================================
# GITHUB CONFIGURATION
#================================================================================================
ATLANTIS_GH_HOSTNAME=github.com
ATLANTIS_GH_USER=gxc-gh-user
ATLANTIS_GH_EMAIL=devops@example.com
ATLANTIS_WEB_HOSTNAME=atlantis.example.com
ATLANTIS_REPO_ALLOWLIST=github.com/GSI-Xapiens-CSIRO/*
ATLANTIS_REPO_CONFIG=/atlantis/repo.yaml
ATLANTIS_CONFIG_PATH=/atlantis/config
ATLANTIS_CHECKOUT_STRATEGY=merge
ATLANTIS_CHECKOUT_DEPTH=10  # Number of commit hash
GIT_USER_NAME="GXC DevOps"

ATLANTIS_HIDE_PREV_PLAN_COMMENTS=true
ATLANTIS_TEST_TIMEOUT=600
ATLANTIS_LOG_LEVEL=warn
ENABLE_SECURITY_AUDIT=true
LOG_LEVEL=INFO

# Security Secrets (DO NOT COMMIT - Set these in .env local)
# ATLANTIS_GH_TOKEN=your-github-token
# ATLANTIS_GH_WEBHOOK_SECRET=your-webhook-secret

#================================================================================================
# AWS CONFIGURATION
#================================================================================================
# Region
AWS_REGION=ap-southeast-3

# Account Structure (replace with your account IDs)
GXC_MANAGEMENT_ACCOUNT=
GXC_SECURITY_ACCOUNT=
GXC_LOGS_ACCOUNT=
GXC_BILLING_ACCOUNT=
GXC_HUB01_ACCOUNT=
GXC_HUB02_ACCOUNT=
GXC_HUB03_ACCOUNT=
GXC_HUB04_ACCOUNT=
GXC_HUB05_ACCOUNT=
GXC_UAT01_ACCOUNT=
GXC_UAT02_ACCOUNT=
GXC_UAT03_ACCOUNT=
GXC_UAT04_ACCOUNT=
GXC_UAT05_ACCOUNT=

#================================================================================================
# SECURITY CONFIGURATION
#================================================================================================
# Basic Auth
NGINX_BASIC_AUTH_USER=gxc-admin
NGINX_BASIC_AUTH_PASS=B4s1c-4uth

#================================================================================================
# TOOL VERSIONS
#================================================================================================
CONFTEST_VERSION=0.56.0
PYTHON_VERSION=3.12
NODE_VERSION=20

#================================================================================================
# RESOURCE LIMITS
#================================================================================================
# Atlantis Resources
ATLANTIS_CPU_LIMIT=2048m
ATLANTIS_MEMORY_LIMIT=8Gi
ATLANTIS_CPU_REQUEST=300m
ATLANTIS_MEMORY_REQUEST=256Mi

# Nginx Resources
NGINX_CPU_LIMIT=300m
NGINX_MEMORY_LIMIT=512Mi
NGINX_CPU_REQUEST=100m
NGINX_MEMORY_REQUEST=128Mi

#================================================================================================
# HEALTH CHECK CONFIGURATION
#================================================================================================
HEALTH_CHECK_INTERVAL=60s
HEALTH_CHECK_TIMEOUT=5s
HEALTH_CHECK_RETRIES=5

#================================================================================================
# WORKFLOW CONFIGURATION
#================================================================================================
# Atlantis Settings
ATLANTIS_AUTOMERGE=true
ATLANTIS_PARALLEL_PLAN=true
ATLANTIS_PARALLEL_APPLY=true
ATLANTIS_ALLOW_COMMANDS=version,plan,apply,unlock,approve_policies

#================================================================================================
# ATLANTIS DATABASE CONFIGURATION
#================================================================================================
ATLANTIS_DB_TYPE=postgres
ATLANTIS_DB_HOST=172.149.149.4
ATLANTIS_DB_PORT=5432
ATLANTIS_DB_NAME=gxc_atlantis_db
ATLANTIS_DB_USER=postgres
ATLANTIS_DB_PASSWORD=
ATLANTIS_DB_SSL_MODE=disable

#================================================================================================
# BACKUP CONFIGURATION
#================================================================================================
BACKUP_RETENTION_DAYS=30
BACKUP_PATH=/backup/atlantis

# =============================================================================
# SONARQUBE CONFIGURATION
# =============================================================================
# Main Controls
ENABLE_SONARQUBE=true                          # true/false - Master toggle
SONARQUBE_REQUIRED=false                       # true/false - Fail pipeline if SonarQube fails
SONARQUBE_QUALITY_GATE_REQUIRED=false          # true/false - Fail on quality gate failure

# SonarQube Server
SONAR_HOST_URL=http://sonarqube_web:9000
SONAR_TOKEN=__sonarqube_token__
SONAR_TOKEN_HUB01=__sonarqube_token__
SONAR_TOKEN_HUB02=__sonarqube_token__
SONAR_TOKEN_HUB03=__sonarqube_token__
SONAR_TOKEN_HUB04=__sonarqube_token__
SONAR_TOKEN_HUB05=__sonarqube_token__
SONAR_TOKEN_UAT01=__sonarqube_token__
SONAR_TOKEN_UAT02=__sonarqube_token__
SONAR_TOKEN_UAT03=__sonarqube_token__
SONAR_TOKEN_UAT04=__sonarqube_token__
SONAR_TOKEN_UAT05=__sonarqube_token__
SONAR_PROJECT_KEY=gxc-cicd-gaspi
SONAR_PROJECT_KEY_HUB01=gxc-cicd-gaspi-hub01
SONAR_PROJECT_KEY_HUB02=gxc-cicd-gaspi-hub02
SONAR_PROJECT_KEY_HUB03=gxc-cicd-gaspi-hub03
SONAR_PROJECT_KEY_HUB04=gxc-cicd-gaspi-hub04
SONAR_PROJECT_KEY_HUB05=gxc-cicd-gaspi-hub05
SONAR_PROJECT_KEY_UAT01=gxc-cicd-gaspi-uat01
SONAR_PROJECT_KEY_UAT02=gxc-cicd-gaspi-uat02
SONAR_PROJECT_KEY_UAT03=gxc-cicd-gaspi-uat03
SONAR_PROJECT_KEY_UAT04=gxc-cicd-gaspi-uat04
SONAR_PROJECT_KEY_UAT05=gxc-cicd-gaspi-uat05

# Scanner Configuration
SONAR_SCANNER_IMAGE=sonarsource/sonar-scanner-cli:latest
SONAR_ANALYSIS_TIMEOUT=3600
SONAR_SCANNER_OPTS=-Xmx2048m

# Container Configuration
CONTAINER_SONAR_SCAN=gxc_sonar_scanner
CONTAINER_SONARQUBE=gxc_sonarqube_local
CONTAINER_IP_SONAR_SCAN=172.149.149.8
CONTAINER_IP_SONARQUBE=172.149.149.9

# Data Directories
DATA_SONAR=/opt/data/docker/sonarqube
DATA_SONAR_REPORTS=/opt/data/docker/sonarqube/reports

# Optional: Local SonarQube Server
PORT_SONARQUBE=9000
SONAR_DB_USER=postgres
SONAR_DB_PASSWORD=
SONAR_WEB_JAVAOPTS=-Xmx2048m -Xms1024m
SONAR_CE_JAVAOPTS=-Xmx2048m -Xms1024m